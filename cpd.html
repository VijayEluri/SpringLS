<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia at Dec 20, 2011 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>CPD Results</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20111220" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                SpringLS
                </div>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
        
                <div class="xleft">
        <span id="publishDate">Last Published: 2011-12-20</span>
                  &nbsp;| <span id="projectVersion">Version: 0.37</span>
                      </div>
            <div class="xright">                    <a href="./" title="SpringLS">SpringLS</a>
              
        
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
        
                                          <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                                          <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                                                                                                                                <li class="expanded">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                    <ul>
                      <li class="none">
                          <a href="checkstyle.html" title="Checkstyle">Checkstyle</a>
            </li>
                      <li class="none">
                          <a href="checkstyle-aggregate.html" title="Checkstyle">Checkstyle</a>
            </li>
                      <li class="none">
                          <a href="pmd.html" title="PMD Report">PMD Report</a>
            </li>
                      <li class="none">
            <strong>CPD Report</strong>
          </li>
                      <li class="none">
                          <a href="findbugs.html" title="FindBugs Report">FindBugs Report</a>
            </li>
                      <li class="none">
                          <a href="dev-activity.html" title="Developer Activity">Developer Activity</a>
            </li>
                      <li class="none">
                          <a href="file-activity.html" title="File Activity">File Activity</a>
            </li>
                      <li class="none">
                          <a href="changelog.html" title="Change Log">Change Log</a>
            </li>
                      <li class="none">
                          <a href="surefire-report.html" title="Surefire Report">Surefire Report</a>
            </li>
                      <li class="none">
                          <a href="jdepend-report.html" title="JDepend">JDepend</a>
            </li>
              </ul>
        </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                   
        
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2>CPD Results<a name="CPD_Results"></a></h2><p>The following document contains the results of PMD's  <a class="externalLink" href="http://pmd.sourceforge.net/cpd.html">CPD</a> 4.2.5.</p></div><div class="section"><h2>Duplications<a name="Duplications"></a></h2><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>com/springrts/springls/accounts/JPAAccountsService.java</td><td>50</td></tr><tr class="a"><td>com/springrts/springls/bans/JPABanService.java</td><td>47</td></tr><tr class="b"><td colspan='2'><div><pre>	public JPABanService() {
		emf = Persistence.createEntityManagerFactory(&quot;springls&quot;);
	}

	private EntityManager open() {

		EntityManager em = emf.createEntityManager();
		return em;
	}
	private void begin(EntityManager em) {
		em.getTransaction().begin();
	}
	private void commit(EntityManager em) {
		em.getTransaction().commit();
	}
	private void rollback(EntityManager em) {

		if (em == null) {
			LOG.error(&quot;Failed to create an entity manager&quot;);
		} else {
			try {
				if (em.isOpen() &amp;&amp; em.getTransaction().isActive()) {
					em.getTransaction().rollback();
				} else {
					LOG.error(&quot;Failed to rollback a transaction: no active&quot;
							+ &quot; connection or transaction&quot;);
				}
			} catch (PersistenceException ex) {
				LOG.error(&quot;Failed to rollback a transaction&quot;, ex);
			}
		}
	}
	private void close(EntityManager em) {

		if (em == null) {
			LOG.error(&quot;Failed to create an entity manager&quot;);
		} else {
			try {
				if (em.isOpen()) {
					em.close();
				}
			} catch (IllegalStateException ex) {
				LOG.error(&quot;Failed to close an entity manager&quot;, ex);
			}
		}
	}

	@Override
	public int getBansSize() {</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>com/springrts/springls/accounts/FSAccountsService.java</td><td>267</td></tr><tr class="a"><td>com/springrts/springls/accounts/LanAccountsService.java</td><td>98</td></tr><tr class="b"><td colspan='2'><div><pre>	public void saveAccountsIfNeeded() {}

	@Override
	public void addAccount(Account acc) {

		if (acc.getId() == Account.NEW_ACCOUNT_ID) {
			acc.setId(++biggestAccountId);
		} else if (acc.getId() &gt; biggestAccountId) {
			biggestAccountId = acc.getId();
		}
		accounts.add(acc);
		map.put(acc.getName(), acc);
		mapNoCase.put(acc.getName(), acc);
	}

	@Override
	public void addAccounts(Iterable&lt;Account&gt; accs) {

		for (Account acc : accs) {
			addAccount(acc);
		}
	}

	@Override
	public boolean removeAccount(Account acc) {

		boolean result = accounts.remove(acc);

		map.remove(acc.getName());
		mapNoCase.remove(acc.getName());

		return result;
	}

	/** Returns null if account is not found */
	@Override
	public Account getAccount(String username) {
		return map.get(username);
	}

	/** Returns 'null' if index is out of bounds */
	public Account getAccount(int index) {

		try {
			return accounts.get(index);
		} catch (IndexOutOfBoundsException ex) {</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>com/springrts/springls/commands/impl/ForceSpectatorModeCommandProcessor.java</td><td>39</td></tr><tr class="a"><td>com/springrts/springls/commands/impl/KickFromBattleCommandProcessor.java</td><td>42</td></tr><tr class="b"><td colspan='2'><div><pre>	public KickFromBattleCommandProcessor() {
		// only the founder can kick other clients
		super(1, 1, Account.Access.NORMAL, true, true);
	}

	@Override
	public boolean process(Client client, List&lt;String&gt; args)
			throws CommandProcessingException
	{
		boolean checksOk = super.process(client, args);
		if (!checksOk) {
			return false;
		}

		Battle battle = getBattle(client);

		String username = args.get(0);

		Client target = getContext().getClients().getClient(username);
		if (target == null) {
			return false;
		}
		if (!battle.isClientInBattle(target)) {
			return false;
		}</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>com/springrts/springls/commands/impl/RemoveScriptTagsCommandProcessor.java</td><td>37</td></tr><tr class="a"><td>com/springrts/springls/commands/impl/SetScriptTagsCommandProcessor.java</td><td>49</td></tr><tr class="b"><td colspan='2'><div><pre>	public SetScriptTagsCommandProcessor() {
		super(1, ARGS_MAX_NOCHECK, Account.Access.NORMAL, true, true);
	}

	@Override
	public boolean process(Client client, List&lt;String&gt; args)
			throws CommandProcessingException
	{
		boolean checksOk = false;
		try {
			checksOk = super.process(client, args);
		} catch (InvalidNumberOfArgumentsCommandProcessingException ex) {
			// kill client since it is not using this command correctly
			client.sendLine(String.format(
					&quot;SERVERMSG Serious error: inconsistent data (%s command).&quot;
					+ &quot; You will now be disconnected ...&quot;, getCommandName()));
			getContext().getClients().killClient(client, &quot;Quit: inconsistent data&quot;);
			return false;
		}
		if (!checksOk) {
			return false;
		}

		Battle battle = getBattle(client);</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>com/springrts/springls/commands/impl/GetAccountAccessCommandProcessor.java</td><td>34</td></tr><tr class="a"><td>com/springrts/springls/commands/impl/GetUserIdCommandProcessor.java</td><td>37</td></tr><tr class="b"><td colspan='2'><div><pre>	public GetUserIdCommandProcessor() {
		super(1, 1, Account.Access.ADMIN);
	}

	@Override
	public boolean process(Client client, List&lt;String&gt; args)
			throws CommandProcessingException
	{
		boolean checksOk = super.process(client, args);
		if (!checksOk) {
			return false;
		}

		String username = args.get(0);

		Account acc = getContext().getAccountsService().getAccount(username);
		if (acc == null) {
			client.sendLine(String.format(&quot;SERVERMSG User &lt;%s&gt; not found!&quot;,
					username));
			return false;
		}

		client.sendLine(String.format(&quot;SERVERMSG Last user ID for &lt;%s&gt; was %d&quot;,</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>com/springrts/springls/commands/impl/MuteCommandProcessor.java</td><td>37</td></tr><tr class="a"><td>com/springrts/springls/commands/impl/UnmuteCommandProcessor.java</td><td>36</td></tr><tr class="b"><td colspan='2'><div><pre>		super(2, 2, Account.Access.PRIVILEGED);
	}

	@Override
	public boolean process(Client client, List&lt;String&gt; args)
			throws CommandProcessingException
	{
		boolean checksOk = super.process(client, args);
		if (!checksOk) {
			return false;
		}

		String chanelName = args.get(0);
		String username = args.get(1);

		Channel chan = getContext().getChannels().getChannel(chanelName);
		if (chan == null) {
			client.sendLine(String.format(
					&quot;SERVERMSG %s failed: Channel #%s does not exist!&quot;,
					getCommandName(), chanelName));
			return false;
		}

		if (!chan.getMuteList().isMuted(username)) {</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>com/springrts/springls/accounts/FSAccountsService.java</td><td>66</td></tr><tr class="a"><td>com/springrts/springls/accounts/LanAccountsService.java</td><td>42</td></tr><tr class="b"><td colspan='2'><div><pre>	private static TreeMap&lt;String, Account&gt; map = new TreeMap&lt;String, Account&gt;(
			new java.util.Comparator&lt;String&gt;() {

				public int compare(String s1, String s2) {
					return s1.compareTo(s2);
				}
			});

	/**
	 * Same as 'map', only that this ignores case.
	 * @see map
	 */
	private static TreeMap&lt;String, Account&gt; mapNoCase
			= new TreeMap&lt;String, Account&gt;(
			new java.util.Comparator&lt;String&gt;() {

				public int compare(String s1, String s2) {
					return s1.compareToIgnoreCase(s2);
				}
			});</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>com/springrts/springls/accounts/FSAccountsService.java</td><td>331</td></tr><tr class="a"><td>com/springrts/springls/accounts/LanAccountsService.java</td><td>156</td></tr><tr class="b"><td colspan='2'><div><pre>	}

	@Override
	public boolean mergeAccountChanges(Account account, String oldName) {

		// persistent here only means, that someone is currently logged in with
		// this name
		final boolean isPersistentAccount = map.containsKey(oldName);
		if (!isPersistentAccount) {
			return false;
		}

		final String newName = account.getName();
		if (!newName.equals(oldName)) {
			// the account was renamed
			map.remove(oldName);
			mapNoCase.remove(oldName);
			map.put(newName, account);
			mapNoCase.put(newName, account);
		}

		return true;
	}

	@Override
	public List&lt;Account&gt; fetchAllAccounts() {
		return accounts;
	}
}</pre></div></td></tr></table></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2005-2011
                        <a href="http://springrts.com">Spring RTS Community</a>.
            All Rights Reserved.      
        
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
